#!/usr/bin/env python
import matplotlib
matplotlib.use('Agg')

import pandas as pd
from visual_behavior.ophys.io.create_multi_session_mean_df import get_multi_session_mean_df

if __name__ == '__main__':

    cache_dir = r'/allen/programs/braintv/workgroups/nc-ophys/visual_behavior/visual_behavior_mesoscope_analysis'
    # manifest = pd.read_csv(os.path.join(cache_dir, 'visual_behavior_data_manifest.csv'))
    # experiment_ids = manifest.experiment_id.values

    # # Mesoscope 4x2 as of 11/16/19
    # experiment_ids = [959389424, 959389426, 959389428, 959389431, 959389434, 959389436, 959389438, 959389440,
    #                   960405649, 960405651, 960405653, 960405655, 960405657, 960405659, 960405661, 960405663,
    #                   960995093, 960995095, 960995097, 960995099, 960995101, 960995103, 960995105, 960995107,
    #                   962676798, 962676800, 962676802, 962676805, 962676807, 962676811, 962676815, 962676817,
    #                   963448995, 963448999, 963449001, 963449003, 963449005, 963449007, 963449009, 963449011,
    #                   964615743, 964615746, 964615749, 964615753, 964615755, 964615757, 964615760, 964615764,
    #                   965270761, 965270764, 965270766, 965270769, 965270771, 965270773, 965270778, 965270780,
    #                   957761407, 957761409, 957761411, 957761413, 957761415, 957761417, 957761419, 957761421,
    #                   964615767, 964615769, 964615771, 964615773, 964615775, 964615777, 964615779, 964615781,
    #                   965267329, 965267331, 965267333, 965267335, 965267337, 965267339, 965267341, 965267343,
    #                   965980147, 965980150, 965980152, 965980154, 965980156, 965980158, 965980160, 965980162,
    #                   967039545, 967039547, 967039549, 967039551, 967039553, 967039555, 967039557, 967039559,
    #                   967906375, 967906377, 967906379, 967906381, 967906385, 967906387, 967906390, 967906392,
    #                   968717796, 968717798, 968717800, 968717802, 968717804, 968717806, 968717808, 968717810,
    #                   969841035, 969841037, 969841039, 969841041, 969841043, 969841045, 969841047, 969841049,
    #                   970223731, 970223733, 970223735, 970223738, 970223740, 970223742, 970223744, 970223746,
    #                   966323512, 966323514, 966323516, 966323518, 966323521, 966323523, 966323525, 966323527,
    #                   967040449, 967040451, 967040454, 967040458, 967040460, 967040462, 967040464, 967040466,
    #                   969430840, 969430843, 969430845, 969430847, 969430849, 969430851, 969430853, 969430855,
    #                   969841053, 969841055, 969841057, 969841059, 969841061, 969841063, 969841065, 969841067,
    #                   972233198, 972233200, 972233202, 972233204, 972233207, 972233209, 972233211, 972233213,
    #                   972760498, 972760500, 972760502, 972760504, 972760506, 972760508, 972760510, 972760513,
    #                   974434621, 974434623, 974434625, 974434627, 974434630, 974434632, 974434634, 974434636,
    #                   974434601, 974434603, 974434605, 974434607, 974434609, 974434611, 974434614, 974434617,
    #                   975608406, 975608408, 975608410, 975608412, 975608414, 975608416, 975608418, 975608420,
    #                   976300311, 976300313, 976300315, 976300317, 976300319, 976300321, 976300323, 976300325,
    #                   977220481, 977220483, 977220485, 977220487, 977220489, 977220491, 977220493, 977220495,
    #                   977975790, 977975792, 977975794, 977975796, 977975798, 977975800, 977975802, 977975804,
    #                   978284048, 978284050, 978284052, 978284054, 978284056, 978284060, 978284062, 978284064,
    #                   978866896, 978866898, 978866900, 978866902, 978866904, 978866906, 978866908, 978866910,
    #                   979726720, 979726722, 979726725, 979726727, 979726729, 979726731, 979726733, 979726736]

    # VisualBehaviorMesoscope 2x4 as of 11/21/19

    experiment_ids = [841968436, 841968438, 841968440, 841968442, 841968445, 841968447, 841968449, 841968452,
                      842545454, 842545456, 842545458, 842545462, 842545466, 842545468, 842545470, 842545472,
                      843007050, 843007052, 843007054, 843007056, 843007058, 843007061, 843007063, 843007065,
                      844420212, 844420214, 844420217, 844420220, 844420222, 844420224, 844420226, 844420229,
                      845070856, 845070858, 845070860, 845070862, 845070864, 845070866, 845070868, 845070870,
                      845777907, 845777909, 845777911, 845777913, 845777915, 845777918, 845777920, 845777922,
                      846546326, 846546328, 846546331, 846546333, 846546335, 846546337, 846546339, 846546341,
                      839716139, 839716141, 839716143, 839716145, 839716147, 839716149, 839716151, 839716153,
                      840460366, 840460368, 840460370, 840460372, 840460376, 840460378, 840460380, 840460383,
                      840717527, 840717529, 840717531, 840717534, 840717536, 840717538, 840717540, 840717542,
                      841624549, 841624552, 841624554, 841624556, 841624560, 841624564, 841624569, 841624576,
                      841969456, 841969458, 841969460, 841969462, 841969465, 841969467, 841969469, 841969471,
                      842545433, 842545435, 842545437, 842545439, 842545442, 842545444, 842545446, 842545448,
                      845783018, 845783021, 845783023, 845783025, 845783027, 845783030, 845783032, 845783034,
                      881949066, 881949068, 881949070, 881949073, 881949075, 881949077, 881949079, 881949081,
                      882551933, 882551935, 882551937, 882551939, 882551943, 882551945, 882551947, 882551950,
                      882968562, 882968564, 882968566, 882968568, 882968570, 882968572, 882968574, 882968577,
                      885146237, 885146239, 885146241, 885146243, 885146245, 885146247, 885146249, 885146253,
                      886587160, 886587162, 886587164, 886587166, 886587168, 886587170, 886587172, 886587174,
                      887386974, 887386977, 887386979, 887386981, 887386983, 887386985, 887386989, 887386991,
                      888876939, 888876941, 888876943, 888876945, 888876947, 888876949, 888876951, 888876953,
                      889806735, 889806737, 889806739, 889806741, 889806743, 889806745, 889806747, 889806749,
                      891108758, 891108760, 891108763, 891108765, 891108767, 891108769, 891108771, 891108773,
                      847267616, 847267618, 847267620, 847267622, 847267624, 847267626, 847267628, 847267630,
                      848039110, 848039113, 848039115, 848039117, 848039119, 848039121, 848039123, 848039125,
                      848760974, 848760977, 848760979, 848760981, 848760983, 848760985, 848760988, 848760990,
                      849233390, 849233392, 849233394, 849233396, 849233398, 849233400, 849233402, 849233404,
                      851085092, 851085095, 851085098, 851085100, 851085103, 851085105, 851085107, 851085109,
                      851958793, 851958795, 851958797, 851958800, 851958802, 851958805, 851958807, 851958809,
                      853362765, 853362767, 853362769, 853362771, 853362773, 853362775, 853362777, 853362780,
                      850517344, 850517346, 850517348, 850517350, 850517352, 850517354, 850517356, 850517358,
                      851093283, 851093285, 851093287, 851093289, 851093291, 851093296, 851093302, 851093306,
                      853363739, 853363743, 853363745, 853363747, 853363749, 853363751, 853363753, 853363756,
                      853988430, 853988435, 853988437, 853988444, 853988446, 853988448, 853988450, 853988454,
                      854759890, 854759894, 854759896, 854759898, 854759900, 854759903, 854759905, 854759907,
                      856123117, 856123119, 856123122, 856123124, 856123126, 856123130, 856123132, 856123134,
                      857698001, 857698006, 857698008, 857698010, 857698012, 857698014, 857698016, 857698018,
                      864430664, 864430666, 864430668, 864430671, 864430675, 864430678, 864430680, 864430682,
                      864967094, 864967096, 864967098, 864967100, 864967102, 864967104, 864967106, 864967108,
                      865798235, 865798237, 865798239, 865798241, 865798245, 865798247, 865798249, 865798251,
                      866518293, 866518296, 866518298, 866518303, 866518305, 866518307, 866518309, 866518311,
                      866518314, 866518316, 866518318, 866518320, 866518322, 866518324, 866518326, 866518328,
                      867410509, 867410512, 867410514, 867410516, 867410518, 867410520, 867410522, 867410524,
                      868870085, 868870092, 868870094, 868870097, 868870100, 868870102, 868870104, 868870106,
                      871196365, 871196367, 871196369, 871196371, 871196373, 871196375, 871196377, 871196379,
                      873963889, 873963891, 873963893, 873963895, 873963897, 873963899, 873963903, 873963905,
                      875786881, 875786883, 875786885, 875786887, 875786891, 875786893, 875786897, 875786899,
                      870142184, 870142189, 870142214, 870142218, 870142223, 870142227, 870142232, 870142236,
                      875564370, 875564388, 875564398, 875564401, 875564408, 875564411, 875564417, 875564420,
                      872499144, 872499146, 872499150, 872499152, 872499154, 872499156, 872499158, 872499160,
                      873970521, 873970523, 873970525, 873970527, 873970529, 873970531, 873970533, 873970535,
                      877669811, 877669813, 877669815, 877669817, 877669819, 877669822, 877669824, 877669826,
                      886000994, 886000996, 886000998, 886001000, 886001002, 886001006, 886001009, 886001011,
                      881003484, 881003487, 881003489, 881003491, 881003493, 881003496, 881003498, 881003500,
                      882551954, 882551956, 882551958, 882551960, 882551962, 882551964, 882551966, 882551968,
                      882967942, 882967944, 882967946, 882967948, 882967950, 882967952, 882967954, 882967956,
                      885146779, 885146781, 885146783, 885146785, 885146787, 885146789, 885146791, 885146793,
                      886003521, 886003523, 886003525, 886003527, 886003529, 886003531, 886003533, 886003535,
                      886585123, 886585126, 886585128, 886585130, 886585132, 886585134, 886585136, 886585138,
                      887386947, 887386949, 887386953, 887386955, 887386958, 887386964, 887386968, 887386970,
                      888879667, 888879669, 888879671, 888879674, 888879676, 888879678, 888879680, 888879682,
                      889806717, 889806719, 889806721, 889806723, 889806725, 889806727, 889806729, 889806731,
                      915229062, 915229064, 915229066, 915229068, 915229070, 915229072, 915229074, 915229076,
                      919418999, 919419001, 919419005, 919419007, 919419009, 919419011, 919419013, 919419015,
                      923144558, 923144560, 923144562, 923144564, 923144567, 923144569, 923144571, 923144573,
                      929604316, 929604318, 929604320, 929604322, 929604324, 929604327, 929604329, 929604331,
                      929603794, 929603796, 929603798, 929603801, 929603803, 929603805, 929603807, 929603809,
                      932381886, 932381888, 932381890, 932381892, 932381894, 932381896, 932381900, 932381902,
                      934550017, 934550019, 934550021, 934550023, 934550025, 934550027, 934550031, 934550033,
                      904363921, 904363923, 904363928, 904363930, 904363932, 904363934, 904363938, 904363940,
                      905955226, 905955228, 905955230, 905955232, 905955236, 905955238, 905955240, 905955242,
                      906910593, 906910595, 906910599, 906910601, 906910603, 906910605, 906910607, 906910609,
                      907694948, 907694950, 907694952, 907694954, 907694956, 907694958, 907694960, 907694963,
                      908381690, 908381692, 908381694, 908381696, 908381698, 908381700, 908381704, 908381706,
                      909177753, 909177755, 909177759, 909177761, 909177763, 909177765, 909177767, 909177769,
                      912791339, 912791341, 912791343, 912791345, 912791349, 912791352, 912791354, 912791356,
                      914107588, 914107592, 914107595, 914107600, 914107604, 914107608, 914107611, 914107616,
                      914580658, 914580660, 914580662, 914580664, 914580666, 914580668, 914580670, 914580672,
                      915243088, 915243090, 915243092, 915243094, 915243096, 915243099, 915243101, 915243103,
                      916220439, 916220441, 916220443, 916220445, 916220447, 916220450, 916220452, 916220454,
                      919382081, 919382083, 919382085, 919382087, 919382089, 919382091, 919382093, 919382095,
                      929655720, 929655722, 929655724, 929655728, 929655730, 929655732, 929655735, 929655737,
                      930996067, 930996069, 930996071, 930996073, 930996076, 930996078, 930996080, 930996082,
                      932372699, 932372701, 932372703, 932372705, 932372707, 932372709, 932372711, 932372713,
                      935514360, 935514362, 935514364, 935514366, 935514368, 935514373, 935514375, 935514378,
                      936500596, 936500602, 936500606, 936500611, 936500617, 936500623, 936500627, 936500631,
                      938002071, 938002073, 938002075, 938002077, 938002079, 938002081, 938002083, 938002088,
                      939471269, 939471272, 939471274, 939471278, 939471282, 939471285, 939471290, 939471298,
                      940433466, 940433468, 940433470, 940433472, 940433474, 940433476, 940433478, 940433480,
                      943518708, 943518711, 943518716, 943518720, 943518725, 943518729, 943518733, 943518738,
                      938002053, 938002056, 938002058, 938002060, 938002062, 938002064, 938002066, 938002068,
                      939471239, 939471241, 939471245, 939471248, 939471250, 939471252, 939471256, 939471259,
                      944115792, 944115799, 944115804, 944115808, 944115814, 944115820, 944115825, 944115831,
                      945586444, 945586446, 945586448, 945586450, 945586452, 945586454, 945586456, 945586458,
                      946513776, 946513778, 946513780, 946513782, 946513784, 946513786, 946513788, 946513790,
                      948704856, 948704858, 948704860, 948704862, 948704864, 948704866, 948704868, 948704870,
                      949723691, 949723693, 949723695, 949723697, 949723699, 949723701, 949723703, 949723706,
                      916803619, 916803621, 916803624, 916803626, 916803628, 916803630, 916803632, 916803634,
                      917820358, 917820362, 917820368, 917820370, 917820372, 917820375, 917820379, 917820382,
                      919418501, 919418503, 919418505, 919418507, 919418509, 919418511, 919418513, 919418515,
                      920288843, 920288845, 920288847, 920288849, 920288851, 920288853, 920288855, 920288857,
                      921024187, 921024189, 921024191, 921024193, 921024195, 921024197, 921024201, 921024204,
                      922122728, 922122730, 922122732, 922122734, 922122738, 922122740, 922122742, 922122744,
                      924198883, 924198885, 924198887, 924198889, 924198891, 924198893, 924198895, 924198897,
                      925843756, 925843758, 925843761, 925843763, 925843765, 925843769, 925843771, 925843773,
                      927102614, 927102616, 927102618, 927102620, 927102622, 927102624, 927102626, 927102628,
                      929653466, 929653468, 929653470, 929653472, 929653474, 929653479, 929653481, 929653483,
                      939481530, 939481532, 939481534, 939481536, 939481538, 939481540, 939481542, 939481544,
                      940433448, 940433450, 940433452, 940433454, 940433456, 940433458, 940433460, 940433462,
                      942596349, 942596351, 942596353, 942596355, 942596357, 942596359, 942596361, 942596363,
                      945586425, 945586427, 945586429, 945586431, 945586433, 945586435, 945586438, 945586440,
                      947798771, 947798773, 947798775, 947798777, 947798779, 947798781, 947798783, 947798785,
                      948689192, 948689194, 948689196, 948689198, 948689200, 948689203, 948689205, 948689207,
                      949723709, 949723711, 949723713, 949723715, 949723717, 949723719, 949723721, 949723723,
                      951213203, 951213205, 951213207, 951213209, 951213211, 951213213, 951213215, 951213217,
                      953668309, 953668311, 953668313, 953668316, 953668318, 953668320, 953668322, 953668324,
                      903485705, 903485708, 903485710, 903485712, 903485714, 903485716, 903485718, 903485720,
                      904352686, 904352688, 904352690, 904352692, 904352694, 904352696, 904352698, 904352700,
                      905955204, 905955207, 905955209, 905955211, 905955213, 905955215, 905955217, 905955219,
                      906910612, 906910614, 906910616, 906910619, 906910621, 906910623, 906910625, 906910627,
                      908381672, 908381674, 908381676, 908381678, 908381680, 908381682, 908381684, 908381686,
                      908381652, 908381654, 908381656, 908381658, 908381660, 908381664, 908381666, 908381668,
                      909184288, 909184290, 909184292, 909184296, 909184298, 909184300, 909184302, 909184304,
                      951980471, 951980473, 951980475, 951980477, 951980479, 951980481, 951980484, 951980486,
                      953659741, 953659743, 953659745, 953659747, 953659749, 953659752, 953659754, 953659756,
                      958527464, 958527471, 958527474, 958527477, 958527479, 958527481, 958527485, 958527488,
                      956941841, 956941844, 956941846, 956941848, 956941851, 956941853, 956941856, 956941858,
                      957759562, 957759564, 957759566, 957759568, 957759570, 957759572, 957759574, 957759576,
                      958741219, 958741222, 958741224, 958741226, 958741228, 958741230, 958741232, 958741234,
                      959388788, 959388790, 959388792, 959388794, 959388796, 959388798, 959388800, 959388802,
                      960410023, 960410026, 960410028, 960410032, 960410035, 960410038, 960410040, 960410042,
                      960995075, 960995077, 960995080, 960995082, 960995084, 960995086, 960995088, 960995090,
                      982344767, 982344769, 982344771, 982344773, 982344775, 982344777, 982344779, 982344781,
                      982903841, 982903843, 982903845, 982903847, 982903849, 982903851, 982903853, 982903855,
                      976300293, 976300295, 976300297, 976300299, 976300301, 976300303, 976300305, 976300307,
                      977247461, 977247464, 977247466, 977247468, 977247470, 977247472, 977247474, 977247476,
                      977978314, 977978319, 977978321, 977978323, 977978325, 977978327, 977978329, 977978331,
                      978296098, 978296100, 978296102, 978296104, 978296106, 978296110, 978296112, 978296114,
                      971813754, 971813756, 971813758, 971813760, 971813762, 971813765, 971813767, 971813769,
                      972233173, 972233175, 972233181, 972233183, 972233187, 972233189, 972233193, 972233195,
                      974433386, 974433388, 974433390, 974433392, 974433395, 974433397, 974433399, 974433401,
                      974358967, 974358969, 974358971, 974358973, 974358975, 974358977, 974358979, 974358981,
                      974362751, 974362753, 974362756, 974362758, 974362760, 974362762, 974362764, 974362767,
                      974994093, 974994095, 974994097, 974994099, 974994101, 974994105, 974994107, 974994109,
                      976300274, 976300276, 976300280, 976300282, 976300284, 976300286, 976300288, 976300290]

    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'image_name'], flashes=True, get_reliability=False)
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'change_image_name', 'trial_type'])
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id'], flashes=True, omitted=True, get_reliability=False)
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'prior_image_name'], flashes=True, omitted=True,
                              get_reliability=False)
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'image_name', 'repeat'], flashes=True,
                              get_reliability=False)
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'image_name', 'engaged'], flashes=True)
    get_multi_session_mean_df(experiment_ids, cache_dir,
                              conditions=['cell_specimen_id', 'image_name', 'engaged', 'repeat'], flashes=True)

    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                           conditions=['cell_specimen_id', 'image_name'], flashes=True, omitted=True, use_events=True)
    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                           conditions=['cell_specimen_id', 'image_name', 'engaged'], flashes=True, use_events=True)
    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                               conditions=['cell_specimen_id', 'change_image_name', 'trial_type', 'engaged'], use_events=True, get_reliability=True)
    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                                       conditions=['cell_specimen_id', 'image_name', 'repeat'], flashes=True, use_events=True, get_reliability=True)
    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                                       conditions=['cell_specimen_id', 'image_name', 'engaged', 'repeat'], flashes=True, use_events=True, get_reliability=True)
    # get_multi_session_mean_df(experiment_ids, cache_dir,
    #                               conditions=['cell_specimen_id', 'change_image_name', 'behavioral_response_type'], use_events=True)
